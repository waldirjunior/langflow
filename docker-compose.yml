version: '3.8'

services:
  # Serviço do Banco de Dados PostgreSQL
  postgres:
    image: postgres:16
    container_name: postgres_db
    restart: unless-stopped
    environment:
      POSTGRES_USER: langflow
      POSTGRES_PASSWORD: langflow
      POSTGRES_DB: langflow
    ports:
      # Expõe a porta do DB apenas para o localhost da VPS.
      # Assim sua app (fora do docker) e o Nginx podem acessar, mas a internet não.
      - "127.0.0.1:5432:5432"
    volumes:
      - langflow-postgres-data:/var/lib/postgresql/data

  # Novo serviço do pgAdmin
  pgadmin:
    image: dpage/pgadmin4
    container_name: pgadmin_gui
    restart: unless-stopped
    environment:
      # Defina aqui o email e senha para o login inicial do pgAdmin
      PGADMIN_DEFAULT_EMAIL: "admin@nairuz.com.br"
      PGADMIN_DEFAULT_PASSWORD: "nairuz"
      # Desativa o modo HTTPS, pois o Nginx cuidará disso (se um dia precisar)
      PGADMIN_LISTEN_PORT: 80
    ports:
      # Expõe a porta 80 do pgAdmin para a porta 5050 do localhost da VPS.
      # O Nginx irá se conectar a esta porta. Ela não fica visível na internet.
      - "127.0.0.1:5050:80"
    volumes:
      # Volume para persistir as configurações do pgAdmin (servidores, usuários, etc.)
      - pgadmin-data:/var/lib/pgadmin
    depends_on:
      # Garante que o pgAdmin só inicie depois que o postgres estiver pronto
      - postgres

volumes:
  langflow-postgres-data:
  pgadmin-data: # Novo volume para os dados do pgAdmin
